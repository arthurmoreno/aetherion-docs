#!/usr/bin/env bash
set -euo pipefail

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Load .env and export all variables
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
if [[ -f .env ]]; then
  # export all vars in .env (skipping blank lines and comments)
  set -o allexport
  # shellcheck disable=SC1091
  source .env
  set +o allexport
else
  echo "โ  .env file not found in $(pwd)"
  exit 1
fi

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Variables we expect from .env:
#   DOCS_SOURCE                   e.g. docs/_build/html
#   WHEEL_HTML_INDEX_COMPATIBLE   e.g. wheel-html-index
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
: "${DOCS_SOURCE:?Need to set DOCS_SOURCE in .env}"
: "${WHEEL_HTML_INDEX_COMPATIBLE:?Need to set WHEEL_HTML_INDEX_COMPATIBLE in .env}"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 1. Clean out old docs (And create .nojekyll)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo "๐งน  Cleaning docs/โฆ"
rm -rf docs
mkdir -p docs
touch docs/.nojekyll

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# 2. Copy generated Sphinx HTML
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo "๐  Copying Sphinx output from ${DOCS_SOURCE} โ docs/"
cp -a "${DOCS_SOURCE}/." docs/

# # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# # 3. Copy release/ into docs/${WHEEL_HTML_INDEX_COMPATIBLE}/
# # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# TARGET="docs/${WHEEL_HTML_INDEX_COMPATIBLE}"
# echo "๐ฆ  Copying release/ โ ${TARGET}/"
# mkdir -p "${TARGET}"
# cp -a release/. "${TARGET}/"

# echo "โ  Done! Your docs/ folder is now up-to-date."
